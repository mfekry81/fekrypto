<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Technical Analysis Scanner v1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .last-update {
            color: #94a3b8;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .grid {
            display: grid;
            grid-template-columns: 550px 1fr;
            gap: 24px;
        }

        @media (max-width: 1400px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            padding: 24px;
            backdrop-filter: blur(10px);
        }

        .panel h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .coin-list {
            max-height: 800px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        @media (max-width: 520px) {
            .coin-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .coin-item {
            background: rgba(51, 65, 85, 0.6);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .coin-item:hover {
            background: rgba(71, 85, 105, 0.8);
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .coin-item.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
        }

        .coin-rank {
            font-size: 12px;
            font-weight: bold;
            color: #64748b;
            margin-bottom: 4px;
        }

        .coin-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
        }

        .coin-left {
            flex: 1;
            min-width: 0;
        }

        .coin-symbol {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .coin-price {
            font-size: 12px;
            color: #94a3b8;
            font-weight: 600;
        }

        .coin-right {
            text-align: right;
        }

        .coin-change {
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
            justify-content: flex-end;
            margin-bottom: 2px;
        }

        .coin-change.positive {
            color: #10b981;
        }

        .coin-change.negative {
            color: #ef4444;
        }

        .coin-volume {
            font-size: 10px;
            color: #94a3b8;
        }

        .coin-footer {
            padding-top: 8px;
            border-top: 1px solid rgba(148, 163, 184, 0.2);
            font-size: 10px;
            color: #94a3b8;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
            font-size: 18px;
            grid-column: 1 / -1;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-section {
            margin-bottom: 20px;
            max-height: 800px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .current-price-box {
            background: rgba(51, 65, 85, 0.6);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .current-price-box h3 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .current-price {
            font-size: 32px;
            font-weight: bold;
            color: #3b82f6;
        }

        .timestamp {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .timeframe-box {
            background: rgba(51, 65, 85, 0.6);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .timeframe-box h4 {
            font-size: 18px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .confidence-badge {
            font-size: 14px;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: normal;
        }

        .confidence-high {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .confidence-medium {
            background: rgba(234, 179, 8, 0.2);
            color: #eab308;
        }

        .confidence-low {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .indicator {
            display: flex;
            flex-direction: column;
        }

        .indicator-label {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 4px;
        }

        .indicator-value {
            font-weight: bold;
            font-size: 16px;
        }

        .indicator-value.bullish {
            color: #10b981;
        }

        .indicator-value.bearish {
            color: #ef4444;
        }

        .indicator-value.oversold {
            color: #10b981;
        }

        .indicator-value.overbought {
            color: #ef4444;
        }

        .indicator-value.warning {
            color: #eab308;
        }

        .trade-setup {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .trade-setup h5 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #60a5fa;
        }

        .setup-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .setup-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 6px;
        }

        .setup-label {
            font-size: 11px;
            color: #94a3b8;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .setup-value {
            font-size: 15px;
            font-weight: bold;
        }

        .setup-value.long {
            color: #10b981;
        }

        .setup-value.short {
            color: #ef4444;
        }

        .setup-value.entry {
            color: #3b82f6;
        }

        .setup-value.stop {
            color: #ef4444;
        }

        .setup-value.target {
            color: #10b981;
        }

        .risk-reward {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .signals-box {
            background: rgba(59, 130, 246, 0.2);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .signals-box h4 {
            font-size: 18px;
            margin-bottom: 16px;
        }

        .signal-item {
            display: flex;
            align-items: start;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .signal-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .signal-content {
            flex: 1;
        }

        .signal-type {
            font-weight: bold;
            text-transform: capitalize;
            margin-bottom: 4px;
        }

        .signal-reason {
            font-size: 14px;
            color: #cbd5e1;
        }

        .warning-box {
            background: rgba(234, 179, 8, 0.2);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid rgba(234, 179, 8, 0.3);
            font-size: 14px;
            margin-top: 20px;
        }

        .warning-box p {
            margin-bottom: 8px;
        }

        .warning-box p:last-child {
            margin-bottom: 0;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .no-trade {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            text-align: center;
            color: #fca5a5;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.4);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(71, 85, 105, 0.8);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.9);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Crypto Technical Analysis Scanner v1</h1>
            <div class="last-update">
                <span>‚è∞</span>
                <span id="lastUpdate">Loading...</span>
            </div>
        </div>

        <div class="grid">
            <div class="panel">
                <h2>Top Scanning Opportunities</h2>
                <div id="coinList" class="coin-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>Loading market data...</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>Technical Analysis & Trade Setups</h2>
                <div id="analysisPanel">
                    <div class="empty-state">
                        <p>Select a coin from the list to view detailed technical analysis and trade setups</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let coins = [];
        let selectedCoin = null;

        // Initialize
        fetchMarketData();
        setInterval(fetchMarketData, 30000);

        async function fetchMarketData() {
            try {
                const response = await fetch('https://api.binance.com/api/v3/ticker/24hr');
                const data = await response.json();
                
                const usdtPairs = data
                    .filter(coin => coin.symbol.endsWith('USDT') && 
                                   !coin.symbol.includes('UP') && 
                                   !coin.symbol.includes('DOWN') &&
                                   !coin.symbol.includes('BULL') &&
                                   !coin.symbol.includes('BEAR'))
                    .map(coin => ({
                        symbol: coin.symbol,
                        price: parseFloat(coin.lastPrice),
                        change: parseFloat(coin.priceChangePercent),
                        volume: parseFloat(coin.volume),
                        quoteVolume: parseFloat(coin.quoteVolume),
                        high: parseFloat(coin.highPrice),
                        low: parseFloat(coin.lowPrice),
                        trades: coin.count
                    }));

                const scored = usdtPairs.map(coin => ({
                    ...coin,
                    score: calculateScore(coin)
                }));

                scored.sort((a, b) => b.score - a.score);
                coins = scored.slice(0, 50);
                
                renderCoinList();
                updateTimestamp();
                
                if (selectedCoin) {
                    fetchDetailedAnalysis(selectedCoin);
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('coinList').innerHTML = 
                    '<div class="loading">Error loading data. Retrying...</div>';
            }
        }

        function calculateScore(coin) {
            let score = 0;
            
            if (Math.abs(coin.change) >= 1) score += 30;
            else if (Math.abs(coin.change) >= 0.5) score += 20;
            else if (Math.abs(coin.change) >= 0.3) score += 10;
            
            const avgVolume = coin.quoteVolume / 24;
            if (avgVolume > 10000000) score += 25;
            else if (avgVolume > 5000000) score += 15;
            
            if (coin.trades > 50000) score += 15;
            
            const range = ((coin.high - coin.low) / coin.low) * 100;
            if (range > 3) score += 20;
            else if (range > 2) score += 10;
            
            return score;
        }

        function renderCoinList() {
            const listElement = document.getElementById('coinList');
            
            listElement.innerHTML = coins.slice(0, 30).map((coin, idx) => `
                <div class="coin-item ${selectedCoin === coin.symbol ? 'selected' : ''}" 
                     onclick="fetchDetailedAnalysis('${coin.symbol}')">
                    <div class="coin-rank">#${idx + 1}</div>
                    <div class="coin-header">
                        <div class="coin-left">
                            <div class="coin-symbol">${coin.symbol}</div>
                            <div class="coin-price">${formatPriceCurrency(coin.price)}</div>
                        </div>
                        <div class="coin-right">
                            <div class="coin-change ${coin.change >= 0 ? 'positive' : 'negative'}">
                                ${coin.change >= 0 ? '‚ñ≤' : '‚ñº'}
                                ${Math.abs(coin.change).toFixed(2)}%
                            </div>
                            <div class="coin-volume">$${(coin.quoteVolume / 1000000).toFixed(1)}M</div>
                        </div>
                    </div>
                    <div class="coin-footer">
                        Score: ${coin.score}
                    </div>
                </div>
            `).join('');
        }

        function updateTimestamp() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `Last updated: ${now.toLocaleTimeString()}`;
        }

        function formatPrice(price) {
            if (price >= 1000) return price.toFixed(2);
            if (price >= 100) return price.toFixed(3);
            if (price >= 10) return price.toFixed(4);
            if (price >= 1) return price.toFixed(4);
            if (price >= 0.01) return price.toFixed(6);
            if (price >= 0.0001) return price.toFixed(6);
            return price.toFixed(8);
        }

        function formatPriceCurrency(price) {
            if (!price || isNaN(price)) return '$0.00';
            
            if (price >= 1000) {
                return '$' + price.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            if (price >= 100) {
                return '$' + price.toFixed(3);
            }
            if (price >= 10) {
                return '$' + price.toFixed(4);
            }
            if (price >= 1) {
                return '$' + price.toFixed(4);
            }
            if (price >= 0.01) {
                return '$' + price.toFixed(6);
            }
            if (price >= 0.0001) {
                return '$' + price.toFixed(6);
            }
            return '$' + price.toFixed(8);
        }

        async function fetchDetailedAnalysis(symbol) {
            selectedCoin = symbol;
            renderCoinList();
            
            const panel = document.getElementById('analysisPanel');
            panel.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading analysis for ${symbol}...</div>
                </div>
            `;
            
            try {
                const [klines1m, klines5m, klines15m] = await Promise.all([
                    fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1m&limit=100`).then(r => r.json()),
                    fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=5m&limit=100`).then(r => r.json()),
                    fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=15m&limit=100`).then(r => r.json())
                ]);

                const analysis1m = analyzeTimeframe(klines1m, '1m');
                const analysis5m = analyzeTimeframe(klines5m, '5m');
                const analysis15m = analyzeTimeframe(klines15m, '15m');

                const coinData = coins.find(c => c.symbol === symbol);
                const signals = generateSignals(analysis1m, analysis5m, analysis15m, coinData);
                
                const tradeSetup1m = generateTradeSetup(analysis1m, coinData, '1m');
                const tradeSetup5m = generateTradeSetup(analysis5m, coinData, '5m');
                const tradeSetup15m = generateTradeSetup(analysis15m, coinData, '15m');
                
                renderAnalysis(symbol, coinData, {
                    '1m': analysis1m,
                    '5m': analysis5m,
                    '15m': analysis15m,
                    signals: signals,
                    tradeSetup1m,
                    tradeSetup5m,
                    tradeSetup15m
                });
            } catch (error) {
                console.error('Error fetching analysis:', error);
                panel.innerHTML = '<div class="loading">Error loading analysis. Please try again.</div>';
            }
        }

        function calculateRSI(prices, period = 14) {
            if (prices.length < period + 1) return null;
            
            let gains = 0, losses = 0;
            for (let i = prices.length - period; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                if (change > 0) gains += change;
                else losses -= change;
            }
            
            const avgGain = gains / period;
            const avgLoss = losses / period;
            if (avgLoss === 0) return 100;
            
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        function calculateEMA(prices, period) {
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) {
                ema = prices[i] * k + ema * (1 - k);
            }
            return ema;
        }

        function calculateMACD(prices) {
            const ema12 = calculateEMA(prices, 12);
            const ema26 = calculateEMA(prices, 26);
            const macd = ema12 - ema26;
            return { macd, ema12, ema26 };
        }

        function calculateATR(highs, lows, closes, period = 14) {
            const trs = [];
            for (let i = 1; i < highs.length; i++) {
                const hl = highs[i] - lows[i];
                const hc = Math.abs(highs[i] - closes[i - 1]);
                const lc = Math.abs(lows[i] - closes[i - 1]);
                trs.push(Math.max(hl, hc, lc));
            }
            
            const atr = trs.slice(-period).reduce((a, b) => a + b, 0) / period;
            return atr;
        }

        function analyzeTimeframe(klines, timeframe) {
            const closes = klines.map(k => parseFloat(k[4]));
            const volumes = klines.map(k => parseFloat(k[5]));
            const highs = klines.map(k => parseFloat(k[2]));
            const lows = klines.map(k => parseFloat(k[3]));
            
            const rsi = calculateRSI(closes);
            const macd = calculateMACD(closes);
            const ema21 = calculateEMA(closes, 21);
            const ema50 = calculateEMA(closes, 50);
            const atr = calculateATR(highs, lows, closes, 14);
            const currentPrice = closes[closes.length - 1];
            
            const avgVolume = volumes.reduce((a, b) => a + b, 0) / volumes.length;
            const currentVolume = volumes[volumes.length - 1];
            const volumeSurge = currentVolume / avgVolume;
            
            const recentHigh = Math.max(...highs.slice(-20));
            const recentLow = Math.min(...lows.slice(-20));
            
            return {
                rsi: rsi,
                macd: macd.macd,
                ema21: ema21,
                ema50: ema50,
                atr: atr,
                emaCross: ema21 > ema50 ? 'Bullish' : 'Bearish',
                volumeSurge: volumeSurge,
                support: recentLow,
                resistance: recentHigh,
                currentPrice: currentPrice,
                trend: closes[closes.length - 1] > closes[closes.length - 10] ? 'Up' : 'Down',
                closes: closes,
                highs: highs,
                lows: lows
            };
        }

        function generateTradeSetup(analysis, coinData, timeframe) {
            const price = analysis.currentPrice;
            const atr = analysis.atr;
            let direction = null;
            let confidence = 0;
            let entry = price;
            let stopLoss = 0;
            let takeProfit1 = 0;
            let takeProfit2 = 0;
            let takeProfit3 = 0;
            
            let bullishSignals = 0;
            let bearishSignals = 0;
            
            // RSI signals
            if (analysis.rsi < 30) bullishSignals += 2;
            if (analysis.rsi > 70) bearishSignals += 2;
            if (analysis.rsi < 40 && analysis.rsi >= 30) bullishSignals += 1;
            if (analysis.rsi > 60 && analysis.rsi <= 70) bearishSignals += 1;
            
            // EMA signals (Supertrend equivalent)
            if (analysis.emaCross === 'Bullish') bullishSignals += 3;
            if (analysis.emaCross === 'Bearish') bearishSignals += 3;
            
            // Trend signals
            if (analysis.trend === 'Up') bullishSignals += 1;
            if (analysis.trend === 'Down') bearishSignals += 1;
            
            // MACD signals
            if (analysis.macd > 0) bullishSignals += 1;
            if (analysis.macd < 0) bearishSignals += 1;
            
            // Volume signals
            if (analysis.volumeSurge > 2) {
                if (analysis.trend === 'Up') bullishSignals += 1;
                else bearishSignals += 1;
            }
            
            // Determine direction based on EMA cross (primary signal like Supertrend)
            if (analysis.emaCross === 'Bullish' && bullishSignals >= 4) {
                direction = 'LONG';
                confidence = Math.min(Math.round((bullishSignals / 9) * 100), 85);
                
                // Pine Script logic: Entry at close, SL = close - (ATR √ó 3)
                entry = price;
                stopLoss = price - (atr * 3);
                
                // Calculate distance for R:R ratios
                const riskDistance = entry - stopLoss;
                
                // TP levels based on R:R - Pine Script uses 1:1, 2:1, 3:1
                takeProfit1 = entry + (riskDistance * 1); // 1:1 R/R
                takeProfit2 = entry + (riskDistance * 2); // 2:1 R/R
                takeProfit3 = entry + (riskDistance * 3); // 3:1 R/R
                
            } else if (analysis.emaCross === 'Bearish' && bearishSignals >= 4) {
                direction = 'SHORT';
                confidence = Math.min(Math.round((bearishSignals / 9) * 100), 85);
                
                // Pine Script logic: Entry at close, SL = close + (ATR √ó 3)
                entry = price;
                stopLoss = price + (atr * 3);
                
                // Calculate distance for R:R ratios
                const riskDistance = stopLoss - entry;
                
                // TP levels based on R:R - Pine Script uses 1:1, 2:1, 3:1
                takeProfit1 = entry - (riskDistance * 1); // 1:1 R/R
                takeProfit2 = entry - (riskDistance * 2); // 2:1 R/R
                takeProfit3 = entry - (riskDistance * 3); // 3:1 R/R
            }
            
            if (timeframe === '1m' && confidence > 0) confidence = Math.max(confidence - 10, 40);
            if (timeframe === '5m' && confidence > 0) confidence = Math.max(confidence - 5, 45);
            
            return {
                direction,
                confidence,
                entry,
                stopLoss,
                takeProfit1,
                takeProfit2,
                takeProfit3,
                riskReward1: '1.00',
                riskReward2: '2.00',
                riskReward3: '3.00',
                atr: atr
            };
        }

        function generateSignals(a1m, a5m, a15m, coinData) {
            const signals = [];
            
            if (a1m.rsi < 30) {
                signals.push({ 
                    type: 'buy', 
                    reason: 'RSI oversold on 1m timeframe (potential bounce)', 
                    strength: 'medium' 
                });
            }
            if (a1m.rsi > 70) {
                signals.push({ 
                    type: 'sell', 
                    reason: 'RSI overbought on 1m timeframe (potential pullback)', 
                    strength: 'medium' 
                });
            }
            
            if (a5m.emaCross === 'Bullish' && a15m.emaCross === 'Bullish') {
                signals.push({ 
                    type: 'buy', 
                    reason: 'EMA bullish cross confirmed on 5m and 15m', 
                    strength: 'strong' 
                });
            }
            
            if (a5m.emaCross === 'Bearish' && a15m.emaCross === 'Bearish') {
                signals.push({ 
                    type: 'sell', 
                    reason: 'EMA bearish cross confirmed on 5m and 15m', 
                    strength: 'strong' 
                });
            }
            
            if (a1m.volumeSurge > 3) {
                signals.push({ 
                    type: 'alert', 
                    reason: `Volume surge detected (${a1m.volumeSurge.toFixed(1)}x average)`, 
                    strength: 'high' 
                });
            }
            
            if (Math.abs(coinData.change) > 1 && a1m.trend === 'Up') {
                signals.push({ 
                    type: 'momentum', 
                    reason: `Strong upward momentum (+${coinData.change.toFixed(2)}%)`, 
                    strength: 'strong' 
                });
            }

            if (Math.abs(coinData.change) > 1 && a1m.trend === 'Down') {
                signals.push({ 
                    type: 'momentum', 
                    reason: `Strong downward momentum (${coinData.change.toFixed(2)}%)`, 
                    strength: 'strong' 
                });
            }

            return signals;
        }

        function renderAnalysis(symbol, coinData, analysis) {
            const panel = document.getElementById('analysisPanel');
            
            const signalsHTML = analysis.signals.length === 0 
                ? '<p style="color: #94a3b8;">No strong technical signals detected at this time.</p>'
                : analysis.signals.map(signal => `
                    <div class="signal-item">
                        <div class="signal-icon">üìä</div>
                        <div class="signal-content">
                            <div class="signal-type">${signal.type} - ${signal.strength}</div>
                            <div class="signal-reason">${signal.reason}</div>
                        </div>
                    </div>
                `).join('');

            panel.innerHTML = `
                <div class="analysis-section">
                    <div class="current-price-box">
                        <h3>${symbol}</h3>
                        <div class="current-price">${formatPrice(coinData.price)}</div>
                        <div class="timestamp">${new Date().toLocaleString()}</div>
                    </div>

                    ${renderTimeframeBox('1m', analysis['1m'], analysis.tradeSetup1m, coinData)}
                    ${renderTimeframeBox('5m', analysis['5m'], analysis.tradeSetup5m, coinData)}
                    ${renderTimeframeBox('15m', analysis['15m'], analysis.tradeSetup15m, coinData)}

                    <div class="signals-box">
                        <h4>Detected Signals</h4>
                        ${signalsHTML}
                    </div>

                    <div class="warning-box">
                        <p><strong>‚ö†Ô∏è Important Reminder</strong></p>
                        <p>This tool displays technical indicators and calculated trade setups. You are responsible for your own trading decisions and risk management. 
                        Consider market conditions, your risk tolerance, and use appropriate position sizing and stop losses.</p>
                    </div>
                </div>
            `;
        }

        function renderTimeframeBox(timeframe, data, tradeSetup, coinData) {
            const rsiClass = data.rsi < 30 ? 'oversold' : data.rsi > 70 ? 'overbought' : '';
            const emaCrossClass = data.emaCross === 'Bullish' ? 'bullish' : 'bearish';
            const volumeClass = data.volumeSurge > 3 ? 'warning' : '';
            
            let confidenceClass = '';
            if (tradeSetup.confidence >= 65) confidenceClass = 'confidence-high';
            else if (tradeSetup.confidence >= 50) confidenceClass = 'confidence-medium';
            else confidenceClass = 'confidence-low';

            const tradeSetupHTML = tradeSetup.direction ? `
                <div class="trade-setup">
                    <h5>Trade Setup (ATR-Based)</h5>
                    <div class="setup-grid">
                        <div class="setup-item">
                            <div class="setup-label">Direction</div>
                            <div class="setup-value ${tradeSetup.direction === 'LONG' ? 'long' : 'short'}">${tradeSetup.direction}</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">Entry Price</div>
                            <div class="setup-value entry">${tradeSetup.entry.toFixed(coinData.price < 1 ? 6 : 2)}</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">Stop Loss</div>
                            <div class="setup-value stop">${tradeSetup.stopLoss.toFixed(coinData.price < 1 ? 6 : 2)}</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">Take Profit 1</div>
                            <div class="setup-value target">${tradeSetup.takeProfit1.toFixed(coinData.price < 1 ? 6 : 2)}</div>
                            <div class="risk-reward">R:R ${tradeSetup.riskReward1}:1</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">Take Profit 2</div>
                            <div class="setup-value target">${tradeSetup.takeProfit2.toFixed(coinData.price < 1 ? 6 : 2)}</div>
                            <div class="risk-reward">R:R ${tradeSetup.riskReward2}:1</div>
                        </div>
                        <div class="setup-item">
                            <div class="setup-label">Take Profit 3</div>
                            <div class="setup-value target">${tradeSetup.takeProfit3.toFixed(coinData.price < 1 ? 6 : 2)}</div>
                            <div class="risk-reward">R:R ${tradeSetup.riskReward3}:1</div>
                        </div>
                    </div>
                </div>
            ` : `
                <div class="no-trade">
                    <strong>No clear trade setup</strong><br>
                    Insufficient signals for a confident trade on this timeframe
                </div>
            `;

            return `
                <div class="timeframe-box">
                    <h4>
                        <span>${timeframe} Timeframe</span>
                        ${tradeSetup.direction ? `<span class="confidence-badge ${confidenceClass}">Confidence: ${tradeSetup.confidence}%</span>` : ''}
                    </h4>
                    <div class="indicators-grid">
                        <div class="indicator">
                            <div class="indicator-label">RSI</div>
                            <div class="indicator-value ${rsiClass}">${data.rsi.toFixed(2)}</div>
                        </div>
                        <div class="indicator">
                            <div class="indicator-label">MACD</div>
                            <div class="indicator-value">${data.macd.toFixed(4)}</div>
                        </div>
                        <div class="indicator">
                            <div class="indicator-label">EMA 21/50</div>
                            <div class="indicator-value ${emaCrossClass}">${data.emaCross}</div>
                        </div>
                        <div class="indicator">
                            <div class="indicator-label">Volume Surge</div>
                            <div class="indicator-value ${volumeClass}">${data.volumeSurge.toFixed(2)}x</div>
                        </div>
                        <div class="indicator">
                            <div class="indicator-label">Support</div>
                            <div class="indicator-value bullish">${data.support.toFixed(coinData.price < 1 ? 6 : 2)}</div>
                        </div>
                        <div class="indicator">
                            <div class="indicator-label">Resistance</div>
                            <div class="indicator-value bearish">${data.resistance.toFixed(coinData.price < 1 ? 6 : 2)}</div>
                        </div>
                    </div>
                    ${tradeSetupHTML}
                </div>
            `;
        }
    </script>
</body>
</html>